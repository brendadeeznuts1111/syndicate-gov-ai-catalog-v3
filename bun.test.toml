# bun.test.toml - Citadel Test Configuration (Latest Bun Best Practices)

[test]
# Test file patterns
test_match = ["**/*.test.ts", "**/*.spec.ts"]
test_ignore = ["**/node_modules/**", "**/dist/**"]

# Coverage settings
coverage = true
coverage_dir = "./coverage"
coverage_threshold = 80
coverage_reporter = ["text", "html"]

# Reporter configuration
reporter = ["dots", "junit"]
reporter_dir = "./test-reports"

# Test environment
preload = ["./tests/setup.ts"]

# Performance settings
timeout = 30000
concurrency = 4

# Mock configuration
mock_preserve = true

# Watch mode (for development)
watch = false

# CI-specific settings
[ci]
coverage = true
coverage_threshold = 85
coverage_reporter = ["text", "lcov", "html"]
reporter = ["junit", "html"]
timeout = 60000
concurrency = 2

# Advanced test configuration
[advanced]
# Bail early after N failures (for CI)
bail = 3
# Re-run each test N times to catch flakes
rerun_each = 5
# Randomize test order with seed
randomize = true
# Set system time for deterministic tests
mock_time = true

# Ultra-locked gate v1.10 configuration
[ultra_locked]
# Per-test GC pressure tracking
gc_pressure_threshold = 15.0
# Async resource leak delta threshold
async_leak_threshold = 0
# Deterministic coverage hash
coverage_hash_enabled = true
# Mutation testing dry run
mutation_dryrun = true
# Enhanced memory monitoring
memory_monitoring = true
# Source map integrity checks
sourcemap_integrity = true
# Timezone matrix testing
timezone_matrix = ["UTC", "America/New_York", "Europe/Berlin"]
# Smol mode for GC forcing
smol_mode = true
